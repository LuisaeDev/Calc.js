/*!
 * Calc.js
 * Version: 1.0.0
 * Copyright (c) 2016 Luis Aguilar
 * https://github.com/VoyagerCodes/Calc.js
 */
!function(){var e=function(){};e.prototype={debug:!1,exp:void 0,constant:{e:Math.E,pi:Math.PI,"π":Math.PI,"∞":1/0},radians:!1},e.prototype.solve=function(e,r){try{if(this.checkSyntax(e)){this.vars=r;var t=this._solveExpresion();return t=Number(t.toFixed(12))}return}catch(o){return this.error={cod:"execution-error",desc:o},void this._console("execution-error",this.error)}},e.prototype.checkSyntax=function(e){this._console("initial-expresion",e),this._console("starting-corrections"),this.error=void 0,this.exp=e,this.exp=this._replaceConstant(this.exp),this._console("fix-replace-constant",this.exp),this.exp=this.exp.split(" ").join(""),this._console("fix-white-spaces",this.exp),this.exp=this._scientificNotation(this.exp),this._console("fix-scientific-notation",this.exp),this.exp=this._operatorsReduction(this.exp),this._console("fix-operators-reduction",this.exp),this.exp=this._replaceSpecialOperators(this.exp),this._console("fix-replace-special-operators",this.exp),this.exp=this._multiplicationWithoutOperator(this.exp),this._console("fix-multiplication-without-operator",this.exp);try{return this._console("starting-syntax-verification"),this._checkParenthesis(this.exp),this._console("syntax-parenthesis"),this._checkOperators(this.exp),this._console("syntax-operators"),this._checkDecimals(this.exp),this._console("syntax-decimals"),this._checkChars(this.exp),this._console("syntax-invalid-chars"),!0}catch(r){return this.error={cod:r[0],desc:r[1]},this._console("syntax-error",this.error),!1}},e.prototype.divide=function(e,r){return 0==e&&0==r?NaN:this._isInfinite(e)&&this._isInfinite(r)?NaN:(this._isInfinite(e)&&0==r?result=e:this._isInfinite(r)?result=0:result=Number(e)/Number(r),result)},e.prototype.pow=function(e,r){return e=Number(e),r=Number(r),result=Math.exp(r*Math.log(Math.abs(e))),0>e&&1==this._isInteger(r)?this._isOdd(r)?-1*result:result:0>e?-1*result:result},e.prototype.cos=function(e){return Number(Math.cos(this._radians(e)).toFixed(15))},e.prototype.sin=function(e){return Number(Math.sin(this._radians(e)).toFixed(15))},e.prototype.tan=function(e){return this.sin(e)/this.cos(e)},e.prototype.asin=function(e){var e=Math.asin(e);return 0==this.radians&&(e/=Math.PI/180),Number(e)},e.prototype.acos=function(e){var e=Math.acos(e);return 0==this.radians&&(e/=Math.PI/180),Number(e)},e.prototype.atan=function(e){var e=Math.atan(e);return 0==this.radians&&(e/=Math.PI/180),Number(e)},e.prototype.csc=function(e){return 1/this.sin(e)},e.prototype.sec=function(e){return 1/this.cos(e)},e.prototype.cot=function(e){return 1/this.tan(e)},e.prototype.e=function(e){return Math.exp(e)},e.prototype.log=function(e){return Math.log10(e)},e.prototype.ln=function(e){return Math.log(e)},e.prototype.abs=function(e){return Math.abs(e)},e.prototype.round=function(e){return Math.round(e)},e.prototype.floor=function(e){return Math.floor(e)},e.prototype.ceil=function(e){return Math.ceil(e)},e.prototype.fact=function(e){if(e>=171)return 1/0;if(0==e)return 1;if(this._isInteger(e)&&e>0){result=e;for(var r=1;e>r;r++)result*=r;return result}},e.prototype.fractionate=function(e){e=Math.round(1e8*e)/1e8;for(var r=Math.ceil(e),t=1,o=r/t,n=1e6;o!=e&&n>0;)e>o?r++:(t++,r=parseInt(e*t,10)),o=r/t,n--;return{num:r,den:t}},e.prototype._replaceConstant=function(e){for(var r,t=/([a-z\π\∞]+)/gi;r=t.exec(e);)r[1]in this.constant&&void 0!=this.constant[r[1]]&&(e=e.substr(0,r.index)+"("+this._toString(this.constant[r[1]])+")"+e.substr(r.index+r[1].length));return e},e.prototype._scientificNotation=function(e){for(var r,t=/([0-9\.0-9]+)E([\+|\-]?[0-9]+)/;r=t.exec(e);)e=e.substr(0,r.index)+this._toString(r[0])+e.substr(r.index+r[0].length);return e},e.prototype._operatorsReduction=function(e){for(var r=0;r<e.length;r++){var t=e.substr(r,2);"--"==t||"++"==t?(e=e.substr(0,r)+"+"+e.substr(r+2),r--):"-+"!=t&&"+-"!=t||(e=e.substr(0,r)+"-"+e.substr(r+2),r--)}return e},e.prototype._replaceSpecialOperators=function(e){return e=e.replace(/˟√(?![˟√|√|∛|∜])/g,"˅"),e=e.replace(/√(?![√|∛|∜])/g,"(2)˅"),e=e.replace(/∛(?![√|∛|∜])/g,"(3)˅"),e=e.replace(/∜(?![√|∛|∜])/g,"(4)˅"),e=e.replace(/²(?![²|³])/g,"^(2)"),e=e.replace(/³(?![²|³])/g,"^(3)"),e=e.replace(/sin\{-1\}/g,"asin"),e=e.replace(/cos\{-1\}/g,"acos"),e=e.replace(/tan\{-1\}/g,"atan")},e.prototype._multiplicationWithoutOperator=function(e){e=e.split(")(").join(")*(");for(var r=0;r<e.length-1;r++){var t=e.substr(r,1),o=e.substr(r+1,1);this._isNumber(t)&&("("==o||this._isLetter(o))&&(e=e.substr(0,r)+t+"*"+e.substr(r+1),r++)}for(var r=0;r<e.length-1;r++){var t=e.substr(r,1),o=e.substr(r+1,1);")"==t&&this._isNumber(o)&&(e=e.substr(0,r+1)+"*"+e.substr(r+1),r++)}return e},e.prototype._checkParenthesis=function(e){for(var r=0,t=0;t<e.length;t++){var o=e.substr(t,1);if("("==o&&r++,")"==o&&r--,0>r)throw["error-parenthesis","Se ha cerrado un paréntesis antes de ser abierto"]}if(0!=r)throw["error-parenthesis","Uno o más paréntesis no han sido cerrados"];if(-1!=e.indexOf("()"))throw["error-parenthesis","Uno o más paréntesis no tienen contenido"]},e.prototype._checkOperators=function(e){var r=e.substr(0,1),t=e.substr(-1);if("˅"==r||"^"==r||"*"==r||"/"==r)throw["error-operator",'La expresión no puede iniciar con el operador "'+r+'"'];if("˅"==t||"^"==t||"*"==t||"/"==t||"+"==t||"-"==t)throw["error-operator",'La expresión no puede finalizar con el operador "'+t+'"'];for(var o=1;o<e.length-1;o++){var n=e.substr(o-1,1),i=e.substr(o,1),s=e.substr(o+1,1);if("+"==i||"-"==i){if("˅"!=n&&"^"!=n&&"*"!=n&&"/"!=n&&"("!=n&&")"!=n&&0==this._isNumber(n)&&0==this._isLetter(n))throw["error-operator",'Se encontró el caracter inválido "'+n+'" antes del operador "'+i+'"'];if("("!=s&&0==this._isNumber(s)&&0==this._isLetter(s))throw["error-operator",'Se encontró el caracter inválido "'+s+'" después del operador "'+i+'"']}if("˅"==i||"^"==i||"*"==i||"/"==i){if(")"!=n&&0==this._isNumber(n)&&0==this._isLetter(n))throw["error-operator",'Se encontró el caracter inválido "'+n+'" antes del operador "'+i+'"'];if("+"!=s&&"-"!=s&&"("!=s&&0==this._isNumber(s)&&0==this._isLetter(s))throw["error-operator",'Se encontró el caracter inválido "'+s+'" después del operador "'+i+'"']}}},e.prototype._checkDecimals=function(e){var r=e.substr(0,1),t=e.substr(-1);if("."==r)throw["error-decimal-syntax","Se encontró un pundo decimal inesperado al inicio de la expresión"];if("."==t)throw["error-decimal-syntax","Se encontró un pundo decimal inesperado al final de la expresión"];for(var o=1;o<e.length-1;o++){var n=e.substr(o-1,1),i=e.substr(o,1),s=e.substr(o+1,1);if("."==i&&(0==this._isNumber(n)||0==this._isNumber(s)))throw["error-decimal-syntax","Se encontró un pundo decimal inesperado"]}for(var a=!1,o=0;o<e.length;o++){var i=e.substr(o,1);if(a){if(this._isOperator(i))a=!1;else if("."==i)throw["error-decimal-syntax","Se definió más de un pundo decimal en un valor"]}else"."==i&&(a=!0)}},e.prototype._checkChars=function(e){for(var r=0;r<e.length;r++){var t=e.substr(r,1);if("."!=t&&"("!=t&&")"!=t&&0==this._isNumber(t)&&0==this._isLetter(t)&&0==this._isOperator(t))throw["error-invalid-char",'Se encontró el caracter inválido "'+t+'"']}},e.prototype._solveExpresion=function(){this._console("starting-operation");for(var e,r,t,o,n,i=0,s="("+this.exp+")",t=s.substr(0,1),o=s.substr(-1);"("==t&&")"==o;){this._console("operating-expression",s);for(var a=0;a<s.length;a++)if(n=s.substr(a,1),")"==n){i=a;break}for(var a=i;a>=0;a--)if(n=s.substr(a,1),"("==n){e=a;break}if(r=s.substr(e+1,i-e-1),r=this._solveSimpleExpresion(r),void 0==r)return;s=s.substr(0,e)+r+s.substr(i+1),t=s.substr(0,1),o=s.substr(-1)}return s=s.replace("{",""),s=s.replace("}",""),s=Number(this._operatorsReduction(s)),this._console("expresion-result",s),s},e.prototype._solveSimpleExpresion=function(e){this._console("operating-simple-expresion",e),this._console("solving-functions");for(var r,t,o,n,i=/([a-z]+)((?:\{|\{\-|\{\+)?(?:[0-9\.0-9]|(?:Infinity))+[\}]?)+/i;r=i.exec(e);){t=r[1],o=r[2],void 0!=o&&(o=o.replace("{",""),o=o.replace("}",""),o=Number(o));var s=["sin","cos","tan","asin","acos","atan","csc","sec","cot","exp","log","ln","abs","round","floor","ceil","fact"];if(-1==s.indexOf(t))throw'Función "'+t+'" no reconocida';if(void 0==o)throw'No se definió el valor a resolver para la función "'+t+'"';switch(t){case"sin":n=this.sin(o);break;case"cos":n=this.cos(o);break;case"tan":n=this.tan(o);break;case"asin":if(-1>o||o>1)throw'Argumento inválido para función "asin"';n=this.asin(o);break;case"acos":if(-1>o||o>1)throw'Argumento inválido para función "acos"';n=this.acos(o);break;case"atan":n=this.atan(o);break;case"csc":n=this.csc(o);break;case"sec":n=this.sec(o);break;case"cot":n=this.cot(o);break;case"exp":n=this.e(o);break;case"log":if(0>=o)throw'La función "log" no puede resolver un valor negativo o cero';n=this.log(o);break;case"ln":if(0>=o)throw'La función "ln" no puede resolver un valor negativo o cero';n=this.ln(o);break;case"abs":n=this.abs(o);break;case"round":n=this.round(o);break;case"floor":n=this.floor(o);break;case"ceil":n=this.ceil(o);break;case"fact":if(o==1/0)n=1/0;else{if(0==this._isInteger(o)||0>o)throw'La función "fact" no puede resolver un valor negativo o decimal';n=this.fact(o)}}if(isNaN(n))throw"Resultado indefinido";e=e.substr(0,r.index)+this._toString(n)+e.substr(r.index+r[0].length),this._console("solving-function",{"function":r[0],result:n,exp:e})}this._console("solved-functions",e),this._console("solving-arithmetic-operations");for(var a=1;3>=a;a++){switch(a){case 1:i=/((?:\{|\{\-|\{\+)?(?:[0-9\.]|[a-zA-Z])+[}]?)([\˅|\^]{1})([+|-]?[{]?[+|-]?(?:[0-9\.]|[a-zA-Z])+[}]?)/;break;case 2:i=/((?:\{|\{\-|\{\+)?(?:[0-9\.]|[a-zA-Z])+[}]?)([\*|\/]{1})([+|-]?[{]?[+|-]?(?:[0-9\.]|[a-zA-Z])+[}]?)/;break;case 3:i=/([\+|\-]?(?:\{|\{\-|\{\+)?(?:[0-9\.]|[a-zA-Z])+[}]?)([\+|\-]{1})([+|-]?[{]?[+|-]?(?:[0-9\.]|[a-zA-Z])+[}]?)/}for(;r=i.exec(e);){if(operand1=r[1],operator=r[2],operand2=r[3],operand1=operand1.replace("{",""),operand1=operand1.replace("}",""),operand2=operand2.replace("{",""),operand2=operand2.replace("}",""),operand1=this._operatorsReduction(operand1),operand2=this._operatorsReduction(operand2),isNaN(Number(operand1))){if(void 0==this._getVar(operand1))throw'Variable "'+operand1+'" no reconocida';operand1=this._getVar(operand1)}else operand1=Number(operand1);if(isNaN(Number(operand2))){if(void 0==this._getVar(operand2))throw'Variable "'+operand2+'" no reconocida';operand2=this._getVar(operand2)}else operand2=Number(operand2);switch(operator){case"˅":if(index=Number(operand1),radicant=Number(operand2),0==index)throw"El índice de una raíz no puede ser cero";if(0==radicant){if(!(index>0))throw"Una raíz con radicando cero solo puede tener un índice positivo";n=0}else if(exponent=1/index,1==this._isInteger(exponent)||this._isInfinite(exponent))n=Math.pow(radicant,exponent);else{if(!(radicant>0))throw"No es posible resolver la raiz";n=Math.pow(radicant,exponent)}break;case"^":if(base=Number(operand1),exponent=Number(operand2),0==base&&0==exponent)throw"No se puede resolver una potencia con exponente y base igual a cero";if(0==exponent)n=1;else if(0==base){if(!(exponent>0))throw"Una potencia con base cero solo puede tener un exponente positivo";n=0}else if(1==this._isInteger(exponent)||Math.abs(exponent)==1/0)n=Math.pow(base,exponent);else{if(!(base>0))throw"No es posible resolver una potencia con base negativa y exponente decimal";n=Math.pow(base,exponent)}break;case"*":n=Number(operand1)*Number(operand2);break;case"/":n=this.divide(operand1,operand2);break;case"+":n=Number(operand1)+Number(operand2);break;case"-":n=Number(operand1)-Number(operand2)}if(isNaN(n))throw"Resultado indefinido";e=e.substr(0,r.index)+this._toString(n)+e.substr(r.index+r[0].length),this._console("solving-operation",{exp:e,leftOperand:r[1],operator:operator,rightOperand:r[3],result:n}),e=this._operatorsReduction(e)}}return e=e.replace("{",""),e=e.replace("}",""),e=this._operatorsReduction(e),"{"+e+"}"},e.prototype._console=function(){this.debug&&console.log(arguments)},e.prototype._getVar=function(e){return"object"==typeof this.vars&&e in this.vars?this.vars[e]:void 0},e.prototype._radians=function(e){return 0==this.radians?e*(Math.PI/180):e},e.prototype._toString=function(e){if(e=Number(e),e=String(e).split(/[eE]/),1==e.length)return e[0];if(0==e[1])return e[0].toString();if(e[0]=e[0].replace(".",""),pos=Number(e[1]),pos<=0){if(e[0]<0)var r="-0.";else var r="0.";for(;++pos;)r+="0";return r+e[0].replace(/^\-/,"")}pos-=e[0].length-1;for(var r=e[0];pos--;)r+="0";return r},e.prototype._isOdd=function(e){return 1===Math.abs(e%2)},e.prototype._isInteger=function(e){return e===parseInt(e,10)},e.prototype._isOperator=function(e){var r="+-*/˅^";return-1!=r.indexOf(e)},e.prototype._isNumber=function(e){return e=Number(e),isNaN(e)?!1:e>=0&&9>=e?!0:void 0},e.prototype._isLetter=function(e){return e.charCodeAt()>=65&&e.charCodeAt()<=90||e.charCodeAt()>=97&&e.charCodeAt()<=122},e.prototype._isInfinite=function(e){return e==-(1/0)||e==1/0},"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return e}):"undefined"!=typeof module&&module.exports&&(module.exports=e),window.Calc=e}();